{
  "metadata": {
    "name": "hipoteca_simulacion_slots_v1",
    "version": "1.0",
    "description": "Slots necesarios para simulacion de hipoteca (cliente banco / no cliente)."
  },
  "slots": [
    {
      "name": "cliente_es_cliente_banco",
      "type": "boolean",
      "prompt": "¿Eres cliente del banco? (sí/no)",
      "validation": "is_bool"
    },
    {
      "name": "nombre_completo",
      "type": "string",
      "prompt": "¿Me puedes decir tu nombre completo (nombre y apellidos)?",
      "required": true,
      "pre_fill_if_client_data": "full_name",
      "validation": "min_length:3"
    },
    {
      "name": "dni_nie",
      "type": "string",
      "prompt": "¿Me puedes decir tu DNI / NIE incluyendo la letra final?",
      "required": true,
      "pre_fill_if_client_data": "dni",
      "validation": "dni_format"
    },
    {
      "name": "fecha_nacimiento",
      "type": "date",
      "prompt": "Necesitaré también tu fecha de nacimiento (DD/MM/YYYY), por favor",
      "required": true,
      "pre_fill_if_client_data": "birth_date",
      "validation": "adult_min_age:18"
    },
    {
      "name": "direccion_postal",
      "type": "string",
      "prompt": "¿Cuál es tu dirección postal actual? Necesitaré la calle, el número, la ciudad y el código postal)",
      "required": true,
      "pre_fill_if_client_data": "address",
      "validation": "min_length:10"
    },
    {
      "name": "telefono",
      "type": "contact",
      "prompt": "¿Cuál es tu número de teléfono móvil?",
      "required": true,
      "pre_fill_if_client_data": "contact",
      "validation": "phone_or_email"
    },
        {
      "name": "email",
      "type": "contact",
      "prompt": "¿Cuál es tu email?",
      "required": true,
      "pre_fill_if_client_data": "contact",
      "validation": "phone_or_email"
    },
    {
      "name": "tipo_vivienda",
      "type": "enum",
      "prompt": "¿Estás buscando una vivienda nueva o de segunda mano?",
      "required": true,
      "values": ["nueva", "segunda_mano"]
    },
    {
      "name": "precio_vivienda",
      "type": "number",
      "prompt": "¿Cuál es el precio de venta de la vivienda que te gustaría comprar?",
      "required": true,
      "validation": "positive_number"
    },
    {
      "name": "entrada",
      "type": "number",
      "prompt": "¿Cuál es la entrada que tienes disponible en euros?",
      "required": true,
      "validation": "non_negative_and_less_than_price"
    },
    {
      "name": "importe_a_financiar",
      "type": "number",
      "prompt": "¿Sabes cuál es el importe que te gustaría financiar? (si no lo sabes, lo calculo = precio - entrada)",
      "required": false,
      "auto_compute": "precio_vivienda - entrada",
      "validation": "positive_number"
    },
    {
      "name": "ingresos_netos_mensuales",
      "type": "number",
      "prompt": "¿Cuáles son tus ingresos netos mensuales en euros? Si recibes 14 pagas, especifícalo en tu respuesta.",
      "required": false,
      "pre_fill_if_client_data": "domiciled_payroll",
      "validation": "non_negative"
    },
    {
      "name": "fuente_ingresos",
      "type": "enum",
      "prompt": "¿Cuáles son tus fuentes de ingresos? Por ejemplo, la nómina, autonomos, pensión de algún tipo, otros",
      "required": false,
      "values": ["nomina", "autonomo", "pension", "otras"]
    },
    {
      "name": "gastos_mensuales_est",
      "type": "number",
      "prompt": "¿Cuáles son tus gastos mensuales estimados (otros créditos como el de coche o al consumo, tarjetas de crédito, alquileres...)?",
      "required": false,
      "validation": "non_negative"
    },
    {
      "name": "situacion_laboral",
      "type": "enum",
      "prompt": "¿Cuál es tu situación laboral actual? Por ejemplo: indefinido, temporal, autonomo, pensionista, desempleado",
      "required": false,
      "values": ["indefinido","temporal","autonomo","pensionista","desempleado"]
    }
  ],
  "validation_functions": {
    "is_bool": "value in [true,false,'sí','no','si']",
    "min_length:3": "len(value.strip()) >= 3",
    "dni_format": "regex match Spanish DNI/NIE patterns",
    "adult_min_age:18": "date difference >= 18 years",
    "phone_or_email": "basic phone or email pattern",
    "positive_number": "value > 0",
    "non_negative": "value >= 0",
    "non_negative_and_less_than_price": "0 <= entrada < precio_vivienda",
    "percent_or_none": "value is None or (0 <= value <= 100)",
    "in_list:[10,15,20,25,30,35,40]": "value in [10,15,20,25,30,35,40]",
    "must_be_true_for_credit_check": "value == true",
    "must_be_true": "value == true"
  },
  "flows": {
    "default": {
      "steps": [
        "cliente_es_cliente_banco",
        "pre_fill_client_data_if_any",
        "confirm_pre_filled_items",
        "collect_missing_slots_in_order",
        "validate_slots",
        "request_consent_for_credit_checks",
        "invoke_credit_checks_and_kcy",
        "compute_simulation",
        "show_results_and_options"
      ]
    }
  }
}
